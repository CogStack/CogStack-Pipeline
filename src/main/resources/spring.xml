<beans  xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:int="http://www.springframework.org/schema/integration"
        xmlns:jee="http://www.springframework.org/schema/jee"
        xmlns:batch="http://www.springframework.org/schema/batch"
        xmlns:batch-int="http://www.springframework.org/schema/batch-integration"
        xmlns:jms="http://www.springframework.org/schema/jms"
        xmlns:int-jms="http://www.springframework.org/schema/integration/jms"                
        xsi:schemaLocation="
            http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms.xsd              
            http://www.springframework.org/schema/batch-integration http://www.springframework.org/schema/batch-integration/spring-batch-integration.xsd
            http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch.xsd           
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd            
            http://www.springframework.org/schema/integration http://www.springframework.org/schema/integration/spring-integration.xsd
            http://www.springframework.org/schema/integration/jms http://www.springframework.org/schema/integration/jms/spring-integration-jms.xsd            
            http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd"
    
    
>
    


    <!-- master -->
    <int:channel id="batch.requests.partitioning" />
    <int-jms:outbound-channel-adapter connection-factory="JMSConnectionFactory" 
                                      channel="batch.requests.partitioning"
                                      destination-name="queue-batch-requests-partitioning" 
    />


    <!-- slave -->
    <int-jms:message-driven-channel-adapter connection-factory="JMSConnectionFactory"
                                            destination-name="queue-batch-requests-partitioning"
                                            channel="batch.handler.in.partitioning"
                                            concurrent-consumers="8"/>
    <int:channel id="batch.handler.in.partitioning" />
    <int:service-activator input-channel="batch.handler.in.partitioning" 
                           output-channel="batch.handler.out.partitioning"
                           ref="stepExecutionRequestHandler" 
                           method="handle" />

    <int:channel id="batch.handler.out.partitioning" />
    <int-jms:outbound-channel-adapter connection-factory="JMSConnectionFactory"
                                      destination-name="queue-batch-replies-partitioning"
                                      channel="batch.handler.out.partitioning" />


    <!-- master -->
    <int-jms:message-driven-channel-adapter connection-factory="JMSConnectionFactory" 
                                            channel="batch.staging.partitioning"
                                            destination-name="queue-batch-replies-partitioning" 
    />

    <int:channel id="batch.staging.partitioning" />

    <int:aggregator ref="partitionHandler" 
                    input-channel="batch.staging.partitioning" 
                    output-channel="batch.replies.partitioning" 
    />

    <int:channel id="batch.replies.partitioning">
        <int:queue />
    </int:channel>
    
</beans>